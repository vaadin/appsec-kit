package com.vaadin.appsec.v8.service;

import java.util.List;

import org.cyclonedx.model.Component;

import com.vaadin.appsec.backend.model.osv.response.OpenSourceVulnerability;
import com.vaadin.appsec.backend.service.BillOfMaterialsStore;
import com.vaadin.appsec.backend.service.OpenSourceVulnerabilityService;
import com.vaadin.appsec.backend.service.VulnerabilityStore;
import com.vaadin.server.ServiceInitEvent;
import com.vaadin.server.VaadinServiceInitListener;

public class VulnerabilityStoreInitListener implements VaadinServiceInitListener {

    @Override
    public void serviceInit(ServiceInitEvent event) {
        OpenSourceVulnerabilityService osvService = new OpenSourceVulnerabilityService();
        List<Component> components = BillOfMaterialsStore.getInstance().getBom().getComponents();
        List<OpenSourceVulnerability> vulnerabilities = osvService.getVulnerabilities(components);
        VulnerabilityStore.getInstance().init(vulnerabilities);
    }
}
